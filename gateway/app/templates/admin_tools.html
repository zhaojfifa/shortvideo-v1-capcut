<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Tools Â· ShortVideo</title>
  <style>
    :root { color-scheme: light; }
    body {
      margin: 0;
      padding: 16px;
      background: #f3f4f6;
      color: #111827;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    .page { max-width: 720px; margin: 0 auto; }
    .card {
      background: #ffffff;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
      padding: 16px;
    }
    h1 { margin: 0 0 12px; font-size: 1.5rem; }
    .row { display: flex; flex-direction: column; gap: 6px; margin-bottom: 12px; }
    label { font-weight: 700; }
    select { padding: 8px 10px; border-radius: 8px; border: 1px solid #e5e7eb; }
    button {
      background: #2563eb;
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 10px 14px;
      font-weight: 700;
      cursor: pointer;
    }
    button:hover { background: #1d4ed8; }
    .muted { color: #6b7280; font-size: 0.9rem; }
    .status { margin-top: 12px; }
  </style>
</head>
<body>
  <div class="page">
    <div class="card">
      <h1>Admin Tools</h1>
      <table style="width:100%; border-collapse: collapse; margin-bottom: 12px;">
        <thead>
          <tr>
            <th style="text-align:left; padding: 6px 4px;">Tool</th>
            <th style="text-align:left; padding: 6px 4px;">Provider</th>
            <th style="text-align:left; padding: 6px 4px;">Enabled</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Parse</td>
            <td><select id="parse-provider"></select></td>
            <td><input type="checkbox" id="parse-enabled" checked /></td>
          </tr>
          <tr>
            <td>Subtitles</td>
            <td><select id="subtitles-provider"></select></td>
            <td><input type="checkbox" id="subtitles-enabled" checked /></td>
          </tr>
          <tr>
            <td>Dub</td>
            <td><select id="dub-provider"></select></td>
            <td><input type="checkbox" id="dub-enabled" checked /></td>
          </tr>
          <tr>
            <td>Pack</td>
            <td><select id="pack-provider"></select></td>
            <td><input type="checkbox" id="pack-enabled" checked /></td>
          </tr>
          <tr>
            <td>Face swap</td>
            <td><select id="face-swap-provider"></select></td>
            <td><input type="checkbox" id="face-swap-enabled" /></td>
          </tr>
        </tbody>
      </table>
      <button id="save-btn" type="button">Save defaults</button>
      <div class="status muted" id="status-text"></div>
    </div>
  </div>

  <script>
    const statusEl = document.getElementById("status-text");

    function setStatus(message) {
      statusEl.textContent = message;
    }

    function populateSelect(selectEl, providers, selected) {
      selectEl.innerHTML = "";
      providers.forEach((name) => {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        if (name === selected) opt.selected = true;
        selectEl.appendChild(opt);
      });
    }

    async function loadDefaults() {
      setStatus("Loading...");
      const res = await fetch("/api/admin/tools");
      if (!res.ok) {
        setStatus(`Failed to load: HTTP ${res.status}`);
        return;
      }
      const data = await res.json();
      const tools = data.tools || {};
      const available = data.available || {};
      const parseTool = tools.parse || {};
      const subtitlesTool = tools.subtitles || {};
      const dubTool = tools.dub || {};
      const packTool = tools.pack || {};
      const faceSwapTool = tools.face_swap || {};
      populateSelect(document.getElementById("parse-provider"), available.parse || [], parseTool.provider);
      populateSelect(document.getElementById("subtitles-provider"), available.subtitles || [], subtitlesTool.provider);
      populateSelect(document.getElementById("dub-provider"), available.dub || [], dubTool.provider);
      populateSelect(document.getElementById("pack-provider"), available.pack || [], packTool.provider);
      populateSelect(document.getElementById("face-swap-provider"), available.face_swap || [], faceSwapTool.provider);
      document.getElementById("parse-enabled").checked = Boolean(parseTool.enabled);
      document.getElementById("subtitles-enabled").checked = Boolean(subtitlesTool.enabled);
      document.getElementById("dub-enabled").checked = Boolean(dubTool.enabled);
      document.getElementById("pack-enabled").checked = Boolean(packTool.enabled);
      document.getElementById("face-swap-enabled").checked = Boolean(faceSwapTool.enabled);
      setStatus("Ready.");
    }

    document.getElementById("save-btn").addEventListener("click", async () => {
      const payload = {
        tools: {
          parse: {
            provider: document.getElementById("parse-provider").value,
            enabled: document.getElementById("parse-enabled").checked,
          },
          subtitles: {
            provider: document.getElementById("subtitles-provider").value,
            enabled: document.getElementById("subtitles-enabled").checked,
          },
          dub: {
            provider: document.getElementById("dub-provider").value,
            enabled: document.getElementById("dub-enabled").checked,
          },
          pack: {
            provider: document.getElementById("pack-provider").value,
            enabled: document.getElementById("pack-enabled").checked,
          },
          face_swap: {
            provider: document.getElementById("face-swap-provider").value,
            enabled: document.getElementById("face-swap-enabled").checked,
          },
        },
      };
      setStatus("Saving...");
      const res = await fetch("/api/admin/tools", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });
      if (!res.ok) {
        const text = await res.text();
        setStatus(`Save failed: ${res.status} ${text}`);
        return;
      }
      setStatus("Saved.");
      await loadDefaults();
    });

    document.addEventListener("DOMContentLoaded", loadDefaults);
  </script>
</body>
</html>
