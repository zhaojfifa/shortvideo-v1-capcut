# v1.8 -> 2.0 Readiness Review

## Summary
This review focuses on documentation coverage and hexagonal-architecture readiness. It also flags routing duplication and storage boundary risks that affect v1.8 to v2.0 migration.

## Key findings (actionable)

1) Duplicate routes for pack download
- `/v1/tasks/{task_id}/pack` exists in:
  - `gateway/routes/v1.py`
  - `gateway/app/routers/tasks.py`
  - `gateway/app/routers/publish.py`
- Risk: different handlers may resolve pack keys differently depending on router order.
- Action: declare a single owner for this path (v1 router or tasks router) and deprecate the others.

2) Dual entrypoints with overlapping routers
- `gateway/main.py` and `gateway/app/main.py` both include router stacks.
- Risk: operational drift, double registration, and inconsistent middleware behavior.
- Action: document the primary entrypoint (per `docs/ARCHITECTURE.md`) and mark the other as legacy.

3) Storage boundary leakage
- `gateway/app/config.py` instantiates adapters directly and is called from services.
- Risk: services depend on adapter wiring, limiting clean port isolation and testability.
- Action: expose storage via a port in the entrypoint and pass into services, or centralize adapter wiring in a single layer.

4) Two pack builders with different key rules
- v1.8 pack may be generated via `steps_v1.run_pack_step` or `pack_service.create_capcut_pack`.
- They upload different keys (`packs/<task_id>/...` vs `.../artifacts/capcut_pack.zip`).
- Risk: inconsistent downloads and ops confusion.
- Action: document a single canonical key rule for v1.8 and deprecate the other.

## Proposed PR split (minimal)
1) **Docs / ownership**
   - Consolidate route ownership map in docs.
   - Document entrypoint selection and deprecations.

2) **Routing consolidation**
   - Choose a single `/v1/tasks/{task_id}/pack` handler.
   - Remove or gate the duplicates.

3) **Storage boundary cleanup**
   - Introduce a storage port in the entrypoint.
   - Remove direct adapter wiring from services over time.

4) **Pack key unification**
   - Select one key format for v1.8.
   - Update the alternate path to forward to the chosen one.

## Risks / migration notes
- Any change to entrypoints or router order can silently change which handler runs.
- Dual pack builders can cause UI and ops to reference different artifacts.
- Documentation is currently ahead of implementation in several areas; keep it consistent with actual runtime behavior.

## Doc updates plan (minimal)
- `docs/overview.md`: route ownership + duplication summary.
- `docs/architecture/hexagonal.md`: boundary notes and next steps.
- `docs/v1.8/ops_baseline.md`: operational checks and storage assumptions.
- `docs/v1.8/pack_spec.md`: pack layout definition for v1.8.
- `docs/legacy/README.md`: index of legacy components.
