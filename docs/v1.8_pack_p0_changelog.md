# v1.8 Pack P0 Changelog

## Overview
- Fix pack download key selection to prefer `pack_key` and keep fallback to `pack_path`.
- Enforce v1.8 CapCut ZIP internal layout under `deliver/packs/<task_id>/...`.
- Align `/v1/pack` response `files[]` with actual ZIP entries.
- Add tests for download behavior and ZIP structure.

## Changes

### Download behavior (v1.8)
- Prefer `pack_key` for `/v1/tasks/{task_id}/pack`, fallback to `pack_path`, and always validate object existence before redirect.

### ZIP structure (v1.8 capcut_v18)
- ZIP entries are now written with fixed arcnames:
  - `deliver/packs/<task_id>/raw/raw.mp4`
  - `deliver/packs/<task_id>/audio/voice_my.<ext>`
  - `deliver/packs/<task_id>/subs/my.srt`
  - `deliver/packs/<task_id>/scenes/.keep`
  - `deliver/packs/<task_id>/manifest.json`
  - `deliver/packs/<task_id>/README.md`
- Minimal `manifest.json` is generated with version, pack_type, task_id, language, and asset paths.

### API response alignment
- `/v1/pack` now returns `files[]` matching the ZIP entry paths above.

## Affected files
- `gateway/app/routers/tasks.py`
- `gateway/app/services/pack_service.py`
- `gateway/app/services/steps_v1.py`
- `tests/test_v18_pack_download.py`

## Validation
- `python -m pytest -q`
  - All tests passed (18 total) in the author environment.
  - Warnings: FastAPI `on_event` deprecation (pre-existing).
